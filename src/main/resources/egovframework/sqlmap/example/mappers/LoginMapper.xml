<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hcnc.cteam.login.LoginMapper">

	<select id="userLogin" resultType="int" parameterType="loginDTO">
		SELECT COUNT(*)
		FROM employee e 
		WHERE id = #{id}
		AND password = SHA2(#{password}, 256);
	</select>
	
	<select id="selectUser" resultType="loginDTO" >
		SELECT emp_code, assign_code, dep_code, id, name, email
		FROM employee 
		WHERE id = #{id}
		AND password = SHA2(#{password}, 256);
	</select>
	
	<select id="selectEmail" resultType="String" parameterType="int">
		SELECT email
		FROM employee
		WHERE emp_code = #{empCode}
	</select>
	
	<select id="selectWork" resultType="attenDTO" parameterType="int">
		SELECT a.emp_code, a.work_date, a.work_start, a.work_end
			,  e.name 
		FROM attendance a JOIN employee e 
			ON a.emp_code = e.emp_code 
		WHERE a.emp_code = #{empCode} 
		AND work_date = CURDATE();
	</select>
	
	<!-- 아이디로 사용자 정보 조회 -->
    <select id="getUserByUserId" parameterType="map" resultType="map">
       SELECT id, password, name, email, dep_code, emp_code, assign_code  
       FROM employee
       WHERE id = #{userId}
          AND password = SHA2(#{password}, 256)
          AND assign_code >= 5
		  AND (resign_date IS NULL OR resign_date >= CURDATE()); 
   </select>
	
</mapper>