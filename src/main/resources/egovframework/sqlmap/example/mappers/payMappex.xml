<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hcnc.cteam.pay.PayMapper">

<select id="nexaGetPayListByCondition" resultType="PayDTO">
         
    SELECT a.emp_code as empCode,       
           a.name as name,              
           d.assign_name as assignName, 
           e.dep_name as depName,       
           b.pay_year as payYear,       
           b.pay_month as payMonth,     
           b.actual_pay as actualPay,
           b.etc as etc  
    FROM employee a
    JOIN pay b ON a.emp_code = b.emp_code
    JOIN assignment d ON a.assign_code = d.assign_code
    JOIN department e ON a.dep_code = e.dep_code
        
    <!-- 검색 조건 -->
    <if test="SEARCH_WORD != null and SEARCH_WORD != '' and SEARCH_TYPE != null">
        <if test="SEARCH_TYPE == 'ALL'">
            AND (a.emp_code LIKE CONCAT('%', #{SEARCH_WORD}, '%')
            OR a.name LIKE CONCAT('%', #{SEARCH_WORD}, '%')
            OR d.assign_name LIKE CONCAT('%', #{SEARCH_WORD}, '%')
            OR e.dep_name LIKE CONCAT('%', #{SEARCH_WORD}, '%'))
        </if>
        <if test="SEARCH_TYPE == 'NAME'">
            AND a.name LIKE CONCAT('%', #{SEARCH_WORD}, '%')
        </if>
        <if test="SEARCH_TYPE == 'ASSIGNMENT'">
            AND d.assign_name LIKE CONCAT('%', #{SEARCH_WORD}, '%')
        </if>
        <if test="SEARCH_TYPE == 'DEPARTMENT'">
            AND e.dep_name LIKE CONCAT('%', #{SEARCH_WORD}, '%')
        </if>
    </if>

    <!-- 년도 및 월 필터링 -->
    <if test="START_YEAR != null and START_MONTH != null and END_YEAR != null and END_MONTH != null">
        AND (b.pay_year BETWEEN #{START_YEAR} AND #{END_YEAR})
        AND (b.pay_month BETWEEN #{START_MONTH} AND #{END_MONTH})
    </if>

    ORDER BY b.pay_year ASC, b.pay_month ASC
</select>

<update id="updatePayEtc" parameterType="PayDTO">
    UPDATE pay
    SET etc = #{etc}, 
        actual_pay = #{actualPay}
    WHERE emp_code = #{empCode}
    AND pay_year = #{payYear}
    AND pay_month = #{payMonth};
</update>


<delete id="deletePay" parameterType="PayDTO">
    DELETE FROM pay
    WHERE emp_code = #{empCode}
    AND pay_year = #{payYear}
    AND pay_month = #{payMonth};
</delete>



</mapper>

